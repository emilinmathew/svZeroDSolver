<!DOCTYPE>
<html>
  <head>
      <title>Vasculature Simulation </title>
      <link rel="stylesheet" href="static/css/style.css">
      <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
      <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>

    <!-- for testing with local version of cytoscape.js -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.js"></script>
      <script src="/static/js/cytoscape-edgehandles.js"></script>
      <script src="/static/js/app.js"></script>
      <script type="module">
        import cytoscapeDomNode from 'https://cdn.skypack.dev/cytoscape-dom-node';
      </script>
  </head>

  <body>
    <div class="header_container">
        <h1>SVZeroDGUI: A No Code 0D Vasculature Generation Platform</h1>
    </div>
    <div class="collapsible_container">
        <button class="collapsible">Instructions</button>
        <div class="content">
            <p>This program allows you to draw a cardiovascular pathway and export it as a JSON file, structured as input for SimVascular’s ZeroD Solver.</p>
            <ol>
                <li>From the dropdown, select the node type you would like to insert.</li>
                <li>Type in the node name.</li>
                <li>To create an edge, click draw mode on and connect two nodes at a time.</li>
                <li>Repeat steps 1-3 until the architecture is fully drawn.</li>
                <li>To delete a node, simply click on it.</li>
                <li>Click Export to JSON to download the text file. Once you get the text file, you can manually add data points.</li>
            </ol>
        </div>
    </div>

    <div class="container">
        <label for="node-type">Select node type:</label>
        <select id="node-type" onchange="updateBoundaryConditionTypeVisibility()">
            <option value="vessel">Vessel</option>
            <option value="valve">Valve</option>
            <option value="chamber">Chamber</option>
            <option value="junction">Junction</option>
            <option value="boundary_condition">Boundary Condition</option>
        </select>
        <div id="boundary-condition-type-container">
            <label for="boundary-condition-type">Select boundary condition type:</label>
            <select id="boundary-condition-type">
                <option value="FLOW">Flow</option>
                <option value="RESISTANCE">Resistance</option>
                <option value="PRESSURE">Pressure</option>
                <option value="RCR">RCR</option>
                <option value="CORONARY">Coronary</option>
            </select>
        </div>

        <label for="node-name">Node name:</label>
        <input type="text" id="node-name" placeholder="Enter node name">

    </div>
    <!-- Modal for collecting node information -->
    <div id="nodeInfoModal" style="display:none;">
        <div id="SimParametersForm" style="display:none;">
            <p id="form-title">Enter Simulation Parameters</p>
            <label for="numcycles">Number of Cardiac Cycles:</label>
            <input type="number" id="numcycles"><br>
            <label for="numtimepts">Number of Time Points per Cardiac Cycles:</label>
            <input type="number" id="numtimepts"><br>
            <label for="output_all_cycles">Output All Cycles:</label>
            <input type="text" id="output_all_cycles"><br>
            <label for="output_variable_based">Output Variable Based:</label>
            <input type="text" id="output_variable_based"><br>
            <button id="submitSimParamButton">Submit</button>
        </div>

        <div id="junctionForm" style="display:none;">
            <p id="form-title">Junction Variables</p>
            <label for="junction-type"> Junction Type</label>
            <select id="junction-type">
                <option value="NORMAL_JUNCTION">Normal Junction </option>
                <option value="BloodVesselJunction">Blood Vessel Junction </option>
            </select>
            <div id="Junction_Parameters_Form" style="display:none;">
                <p id="form-title">Enter Junction Parameters</p>
                <div class="double-input-container">
                    <div>
                        <label for="R_poiseuille1">R_poiseuille</label>
                        <input type="number" id="R_poiseuille1">
                    </div>
                    <div>
                        <label for="R_poiseuille2">R_poiseuille</label>
                        <input type="number" id="R_poiseuille2"><br>
                    </div>
                    <div>
                        <label for="L1">L:</label>
                        <input type="number" id="L1">
                    </div>
                    <div>
                        <label for="L2">L:</label>
                        <input type="number" id="L2"><br>
                    </div>
                    <div>
                        <label for="junction_stenosis_coefficient1">Stenosis Coefficient:</label>
                        <input type="number" id="junction_stenosis_coefficient1">
                    </div>
                    <div>
                        <label for="junction_stenosis_coefficient2">Stenosis Coefficient:</label>
                        <input type="number" id="junction_stenosis_coefficient2">
                    </div>
                </div>
            </div>
            <button id="submitJunctionButton">Submit</button>
        </div>

        <div id="vesselForm" style="display:none;">
          <p id="form-title">Enter Vessel Information</p>
          <label for="vesselLengthInput">Vessel Length (cm):</label>
          <input type="number" id="vesselLengthInput"><br>
          <label for="vesselRadiusInput">Vessel Radius (cm):</label>
          <input type="number" id="vesselRadiusInput"><br>
          <label for="vesselStenosisDiameterInput">Stenosis Diameter:</label>
          <input type="number" id="vesselStenosisDiameterInput"><br>


          <p id="form-title">Solver Variables</p>
          <label for="young_mod_input"> Young's Modulus:</label>
          <select id="young_mod_input">
<!--              the actual option value is in dyn/cm² -->
                <option value="2,500,000">Aorta (2.5 * 10^6 dyn/cm^2) </option>
                <option value="11,500,000">Coronary Arteries (1.15 * 10^7 dyn/cm^2) </option>
                <option value="8900000">Cerebral (8.9 * 10^6 dyn/cm^2) </option>
               <option value="custom">Custom</option>
          </select>
          <input type="number" id="custom_young_mod" style="display:none;" placeholder="Please enter in dyn/cm²)"><br>

          <label for="mu_input"> Blood Viscosity :</label>
          <select id="mu_input">
                <option value="0.025">Standard (2.5 mPa * s) </option>
               <option value="custom">Custom</option>
          </select>
          <input type="number" id="custom_mu" style="display:none;" placeholder="Please enter in mPa/s"><br>

          <label for="h_input"> Vessel Thickness:</label>
          <select id="h_input">
                <option value="0.10">Standard (10%) </option>
               <option value="custom">Custom</option>
          </select>
          <input type="number" id="custom_thickness" style="display:none;" placeholder="Enter custom value (decimal)"><br>

          <label for="rho_input"> Blood Density :</label>
          <select id="rho_input">
                <option value="1.06">Standard (1.06 g/cm^3) </option>
               <option value="custom">Custom</option>
          </select>
          <input type="number" id="custom_rho" style="display:none;" placeholder="Please enter in g/cm^3"><br>

          <button id="submitVesselButton">Submit</button>
        </div>

        <div id="valveForm" style="display:none;">
            <p id="form-title">Enter Valve Information</p>
            <label for="Rmax">Rmax:</label>
            <input type="number" id="Rmax"><br>
            <label for="Rmin">Rmin:</label>
            <input type="number" id="Rmin"><br>
            <label for="Steepness">Steepness:</label>
            <input type="number" id="Steepness"><br>
            <button id="submitValveButton">Submit</button>
        </div>
        <div id="chamberForm" style="display:none;">
            <p id="form-title">Enter Chamber Information</p>
            <label for="Emax">Emax:</label>
            <input type="number" id="Emax"><br>
            <label for="Emin">Emin:</label>
            <input type="number" id="Emin"><br>
            <label for="Vrd">Vrd:</label>
            <input type="number" id="Vrd"><br>
            <label for="Vrs">Vrs:</label>
            <input type="number" id="Vrs"><br>
            <label for="t_active">t_active:</label>
            <input type="number" id="t_active"><br>
            <label for="t_twitch">t_twitch:</label>
            <input type="number" id="t_twitch"><br>
            <label for="Impedance">Impedance:</label>
            <input type="number" id="Impedance"><br>
            <button id="submitChamberButton">Submit</button>
        </div>

        <div id="RCRForm" style="display:none;">
            <p id="form-title">Enter RCR Information</p>
            <label for="RCR_C">C:</label>
            <input type="number" id="RCR_C"><br>
            <label for="RCR_Pd">Pd:</label>
            <input type="number" id="RCR_Pd"><br>
            <label for="RCR_Rd">Rd:</label>
            <input type="number" id="RCR_Rd"><br>
            <label for="RCR_Rp">Rp:</label>
            <input type="number" id="RCR_Rp"><br>
            <button id="submitRCRButton">Submit</button>
        </div>
        <div id="ResistanceForm" style="display:none;">
            <p id="form-title">Enter Resistance Information</p>
            <label for="R_Pd">Pd:</label>
            <input type="number" id="R_Pd"><br>
            <label for="R_R">R:</label>
            <input type="number" id="R_R"><br>
            <button id="submitResistanceButton">Submit</button>
        </div>
        <div id="FlowForm" style="display:none;">
            <p id="form-title">Enter Flow Information</p>
            <div style="margin-bottom: 10px;">
                <label for="flow-file-upload">Upload a text file for flow rates:</label>
                <input type="file" id="flow-file-upload" accept=".txt">
                <br>
                <label for="flow-manual-input">Or enter comma-separated values:</label>
                <input type="text" id="flow-manual-input" placeholder="e.g. 1.2, 3.4, 5.6">
            </div>
            <div style="margin-bottom: 10px;">
                <label for="flow-time-file-upload">Upload a text file for time data:</label>
                <input type="file" id="flow-time-file-upload" accept=".txt">
                <br>
                <label for="flow-time-manual-input">Or enter comma-separated values:</label>
                <input type="text" id="flow-time-manual-input" placeholder="e.g. 1.2, 3.4, 5.6">
            </div>
            <button id="submitFlowButton">Submit</button>
        </div>
        <div id="PressureForm" style="display:none;">
            <p id="form-title">Enter Pressure Information</p>
            <div style="margin-bottom: 10px;">
                <label for="pressure-file-upload">Upload a text file for pressure data:</label>
                <input type="file" id="pressure-file-upload" accept=".txt">
                <br>
                <label for="pressure-manual-input">Or enter comma-separated values:</label>
                <input type="text" id="pressure-manual-input" placeholder="e.g. 1.2, 3.4, 5.6">
            </div>
            <div style="margin-bottom: 10px;">
                <label for="pressure-time-file-upload">Upload a text file for time data:</label>
                <input type="file" id="pressure-time-file-upload" accept=".txt">
                <br>
                <label for="pressure-time-manual-input">Or enter comma-separated values:</label>
                <input type="text" id="pressure-time-manual-input" placeholder="e.g. 1.2, 3.4, 5.6">
            </div>
            <button id="submitPressureButton">Submit</button>
        </div>
        <div id="CoronaryForm" style="display:none;">
            <p id="form-title">Enter Coronary Information</p>
            <label for="Ca">Ca:</label>
            <input type="number" id="Ca"><br>
            <label for="Cc">Cc:</label>
            <input type="number" id="Cc"><br>
            <div style="margin-bottom: 10px;">
                <label for="Pim-file-upload">Upload a text file for Pim data:</label>
                <input type="file" id="Pim-file-upload" accept=".txt">
                <br>
                <label for="Pim-manual-input">Or enter comma-separated values:</label>
                <input type="text" id="Pim-manual-input" placeholder="e.g. 1.2, 3.4, 5.6">
            </div>
            <label for="P_v">P_v:</label>
            <input type="number" id="P_v"><br>
            <label for="Ra1">Ra1:</label>
            <input type="number" id="Ra1"><br>
            <label for="Ra2">Ra2:</label>
            <input type="number" id="Ra2"><br>
            <label for="Rv1">Rv1:</label>
            <input type="number" id="Rv1"><br>
            <div style="margin-bottom: 10px;">
                <label for="coronary-time-file-upload">Upload a text file for time data:</label>
                <input type="file" id="coronary-time-file-upload" accept=".txt">
                <br>
                <label for="coronary-time-manual-input">Or enter comma-separated values:</label>
                <input type="text" id="coronary-time-manual-input" placeholder="e.g. 1.2, 3.4, 5.6">
            </div>
            <button id="submitCoronaryButton">Submit</button>
        </div>
    </div>


    </div>
    <div id="cy"></div>
    <div id="buttons">
        <button id="edge-draw-button">Turn Draw Mode On</button>
        <button id="export-json">Export to JSON</button>
        <button id="delete-node-button">Enter Delete Node Mode</button>
        <button id="delete-edge-button"> Enter Delete Edge Mode </button>
    </div>
  </body>
</html>